import{c as J,a as p,f as x}from"../chunks/DXwTCEs2.js";import{o as fe}from"../chunks/CKHj2-aw.js";import{ar as ge,x as P,as as me,i as pe,b as be,at as _e,au as ye,ag as ke,an as K,ai as xe,a1 as e,am as g,g as a,aj as h,ak as f,av as Ae,ao as w,ah as y}from"../chunks/e8XAVhbW.js";import{s as W}from"../chunks/Dl4wrC1f.js";import{i as O}from"../chunks/B2-igs9x.js";import{r as Q,s as Se}from"../chunks/BRyW6QQ3.js";import{c as Ce,s as X}from"../chunks/BoqZBqRB.js";import{d as Ee,e as we}from"../chunks/CvInUrh1.js";function Y(t,b,v=b){var _=new WeakSet;ge(t,"input",async u=>{var c=u?t.defaultValue:t.value;if(c=D(t)?F(c):c,v(c),P!==null&&_.add(P),await me(),c!==(c=b())){var n=t.selectionStart,l=t.selectionEnd,A=t.value.length;if(t.value=c??"",l!==null){var C=t.value.length;n===l&&l===A&&C>A?(t.selectionStart=C,t.selectionEnd=C):(t.selectionStart=n,t.selectionEnd=Math.min(l,C))}}}),(pe&&t.defaultValue!==t.value||be(b)==null&&t.value)&&(v(D(t)?F(t.value):t.value),P!==null&&_.add(P)),_e(()=>{var u=b();if(t===document.activeElement){var c=ye??P;if(_.has(c))return}D(t)&&u===F(t.value)||t.type==="date"&&!u&&!t.value||u!==t.value&&(t.value=u??"")})}function D(t){var b=t.type;return b==="number"||b==="range"}function F(t){return t===""?null:+t}var Oe=x('<div class="login-container svelte-1uha8ag"><div class="login-card svelte-1uha8ag"><p>Checking authentication...</p></div></div>'),Me=x('<div class="page-container svelte-1uha8ag"><h1 class="svelte-1uha8ag"> </h1> <div class="stats-grid svelte-1uha8ag"><div class="stat-box stat-box-blue svelte-1uha8ag"><h2 class="stat-title svelte-1uha8ag">Shooting level</h2> <p class="stat-value svelte-1uha8ag">1</p></div> <div class="stat-box stat-box-green svelte-1uha8ag"><h2 class="stat-title svelte-1uha8ag">Total Badges</h2> <p class="stat-value svelte-1uha8ag">0</p></div> <div class="stat-box stat-box-purple svelte-1uha8ag"><h2 class="stat-title svelte-1uha8ag">This Week</h2> <p class="stat-value svelte-1uha8ag">0</p></div> <div class="stat-box stat-box-orange svelte-1uha8ag"><h2 class="stat-title svelte-1uha8ag">Avg Accuracy</h2> <p class="stat-value svelte-1uha8ag">0.00%</p></div></div></div>'),Te=x("<div> </div>"),Ve=x("<div> </div>"),Pe=x(`<div class="form-group svelte-1uha8ag"><label for="otp" class="svelte-1uha8ag">6-Digit Code (if email didn't arrive)</label> <input id="otp" type="text" placeholder="000000" maxlength="6" autocomplete="one-time-code" class="svelte-1uha8ag"/> <button type="button" class="btn btn-primary svelte-1uha8ag"> </button></div>`),We=x('<button type="submit" class="btn btn-primary svelte-1uha8ag"> </button>'),ze=x('<div class="divider svelte-1uha8ag"><span class="svelte-1uha8ag">or</span></div>'),Ue=x('<div class="login-container svelte-1uha8ag"><div class="login-card svelte-1uha8ag"><h1 class="svelte-1uha8ag">Welcome</h1> <p class="subtitle svelte-1uha8ag">Sign in to your account</p> <!> <!> <form><div class="form-group svelte-1uha8ag"><label for="email" class="svelte-1uha8ag">Email</label> <input id="email" type="email" placeholder="you@example.com" required class="svelte-1uha8ag"/></div> <!></form> <!> <div class="social-buttons svelte-1uha8ag"><button type="button" class="btn btn-social btn-google svelte-1uha8ag"><svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"></path><path d="M9 18c2.43 0 4.467-.806 5.965-2.184l-2.908-2.258c-.806.54-1.837.86-3.057.86-2.35 0-4.34-1.587-5.053-3.72H.957v2.332C2.438 15.983 5.482 18 9 18z" fill="#34A853"></path><path d="M3.947 10.698c-.18-.54-.282-1.117-.282-1.698s.102-1.158.282-1.698V4.97H.957C.348 6.175 0 7.55 0 9s.348 2.825.957 4.03l2.99-2.332z" fill="#FBBC05"></path><path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.97L3.947 7.3C4.66 5.163 6.65 3.58 9 3.58z" fill="#EA4335"></path></svg> Continue with Google</button></div></div></div>');function $e(t,b){ke(b,!0);let v=g(null),_=g(""),u=g(""),c=g(!1),n=g(!1),l=g(""),A=g(null),C=g(""),m=g(null),M=g(null),z=g(!0);fe(()=>{e(v,Ce(),!0),Z(),a(v).auth.onAuthStateChange((s,r)=>{r?.user?(e(m,r.user,!0),r=r):(e(m,null),r=null),e(z,!1)})});async function Z(){if(a(v)){e(z,!0);try{const{data:{session:s},error:r}=await a(v).auth.getSession();r?(console.error("Auth error:",r),e(m,null),e(M,null)):s?.user?(e(m,s.user,!0),e(M,s,!0)):(e(m,null),e(M,null))}catch(s){console.error("Error checking auth:",s),e(m,null),e(M,null)}finally{e(z,!1)}}}async function ee(){if(a(v)){if(!a(_)){e(l,"Please enter your email address");return}e(n,!0),e(l,""),e(c,!1),e(u,"");try{const{data:s,error:r}=await a(v).auth.signInWithOtp({email:a(_),options:{emailRedirectTo:`${window.location.origin}/auth/callback`,shouldCreateUser:!0}});if(r){console.error("Magic link error:",r),r.message.includes("email")?e(l,`Email error: ${r.message}. Check your Supabase email configuration.`):r.message.includes("rate limit")?e(l,"Too many requests. Please wait a moment and try again."):e(l,`Error: ${r.message}`);return}e(c,!0),e(l,"✓ Email sent! Check your inbox for the magic link.")}catch(s){console.error("Unexpected error:",s),e(l,s instanceof Error?`Unexpected error: ${s.message}`:"An unexpected error occurred",!0)}finally{e(n,!1)}}}async function ae(){if(a(v)){if(!a(u)||a(u).length!==6){e(l,"Please enter a valid 6-digit code");return}e(n,!0),e(l,"");try{const{data:s,error:r}=await a(v).auth.verifyOtp({email:a(_),token:a(u),type:"email"});if(r){console.error("OTP verification error:",r),e(l,`Verification failed: ${r.message}`);return}s?.user&&(e(m,s.user,!0),e(M,s.session,!0),e(c,!1),e(u,""),e(l,"✓ Successfully verified!"))}catch(s){console.error("Unexpected error:",s),e(l,s instanceof Error?`Error: ${s.message}`:"An error occurred during verification",!0)}finally{e(n,!1)}}}async function te(s){if(!a(v)){e(l,"Error: Supabase client not initialized. Please refresh the page.");return}e(n,!0),e(l,"");try{console.log("Starting OAuth login with",s);const{data:r,error:T}=await a(v).auth.signInWithOAuth({provider:s,options:{redirectTo:`${window.location.origin}/auth/callback`}});if(T)throw console.error("OAuth error:",T),T;console.log("OAuth redirect data:",r),setTimeout(()=>{r?.url||(e(l,"OAuth redirect did not start. Please check your browser console for errors."),e(n,!1))},1e3)}catch(r){console.error("OAuth login error:",r),e(l,r instanceof Error?r.message:"An error occurred during OAuth login",!0),e(n,!1)}}var $=J(),re=K($);{var se=s=>{var r=Oe();p(s,r)},le=s=>{var r=J(),T=K(r);{var oe=E=>{var S=Me(),V=h(S),U=h(V);f(V),Ae(2),f(S),w(B=>W(U,`Welcome back, ${B??""}!`),[()=>(a(m).user_metadata?.full_name||a(m).user_metadata?.name||"User").split(" ")[0]]),p(E,S)},ie=E=>{var S=Ue(),V=h(S),U=y(h(V),4);{var B=o=>{var i=Te();let d;var k=h(i,!0);f(i),w(()=>{d=X(i,1,"connection-status svelte-1uha8ag",null,d,{error:a(A)==="error",checking:a(A)==="checking"}),W(k,a(A)==="checking"?"⏳ Checking connection...":a(C))}),p(o,i)};O(U,o=>{a(A)&&o(B)})}var N=y(U,2);{var ne=o=>{var i=Ve();let d;var k=h(i,!0);f(i),w(q=>{d=X(i,1,"message svelte-1uha8ag",null,d,q),W(k,a(l))},[()=>({error:a(l).includes("error")||a(l).includes("Error")})]),p(o,i)};O(N,o=>{a(l)&&o(ne)})}var L=y(N,2),H=h(L),I=y(h(H),2);Q(I),f(H);var ue=y(H,2);{var ce=o=>{var i=Pe(),d=y(h(i),2);Q(d),Se(d,"pattern","[0-9]6");var k=y(d,2);k.__click=ae;var q=h(k,!0);f(k),f(i),w(()=>{d.disabled=a(n),k.disabled=a(n)||!a(u)||a(u).length!==6,W(q,a(n)?"Verifying...":"Verify Code")}),Y(d,()=>a(u),he=>e(u,he)),p(o,i)},ve=o=>{var i=We(),d=h(i,!0);f(i),w(()=>{i.disabled=a(n),W(d,a(n)?"Sending...":"Send Magic Link")}),p(o,i)};O(ue,o=>{a(c)?o(ce):o(ve,!1)})}f(L);var j=y(L,2);{var de=o=>{var i=ze();p(o,i)};O(j,o=>{a(c)||o(de)})}var G=y(j,2),R=h(G);R.__click=()=>te("google"),f(G),f(V),f(S),w(()=>{I.disabled=a(n)||a(c),R.disabled=a(n)}),we("submit",L,o=>{o.preventDefault(),ee()}),Y(I,()=>a(_),o=>e(_,o)),p(E,S)};O(T,E=>{a(m)?E(oe):E(ie,!1)},!0)}p(s,r)};O(re,s=>{a(z)?s(se):s(le,!1)})}p(t,$),xe()}Ee(["click"]);export{$e as component};
